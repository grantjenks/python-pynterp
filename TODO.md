# TODO

## Baseline (CPython 3.14, probe basis=`tests`, mode=`module`)

- Source snapshot: `origin/3.14` (`a58ea8c2123`)
- Probe command: `scripts/cpython_pynterp_probe.py --basis tests --mode module`
- Unsupported filters enabled: `__import__`, `__dict__`
- Applicable test files: `515 / 762` (`67.59%`)
- Estimated individual tests total: `15,339`
- Individual pass: `9,406`
- Individual skip: `1,239`
- Individual fail: `4,694`
- Individual pass rate: `61.32%`
- Individual pass+skip rate: `69.40%`

## Repo maintenance (2026-02-27)

- Added safe-stdlib allowlist entries for `operator`, `collections`, and `collections.abc` to keep bootstrap/self-hosting imports working after interpreter runtime updates.
- Updated restricted import behavior to match `__import__` for dotted names with empty `fromlist` (return top-level package), which unblocked `import collections.abc` usage in interpreted stdlib modules.
- Added minimal compatibility builtins required by that bootstrap path (`staticmethod`, `bytearray`, `bytes`).
- Updated `scripts/todo_loop.sh` progress detection to compare a repository content fingerprint (HEAD + tracked diffs + untracked file hashes, excluding the loop log dir), so edits to already-modified files count as progress and do not trigger false stagnation.
- Updated `scripts/todo_loop.sh` to support `--max-stagnant 0` (disable stagnation-based early stop).
- Cleaned prior loop artifacts by removing `.todo-loop/` and gitignoring `.todo-loop/`.
- Verification: `UV_CACHE_DIR=.uv-cache uv run pytest` -> `83 passed, 3 skipped`.

## Prioritized backlog (sorted by individual test impact)

1. Reduce `Suite/Error` failures (`2,490` tests impacted).
- Reason: this is the largest bucket and masks many correctness gaps.
- Requirement: extend the probe to emit top exception signatures from `unittest` `result.errors`, then implement fixes for the top 3 signatures first.
- Progress (2026-02-27): probe now emits per-module `error_signatures` from `result.errors` and aggregates them into report/console section `top_suite_error_signatures` with sample files.
- Progress (2026-02-27): implemented `ast.Lambda` runtime support (closure capture, defaults/kw-defaults, and expression-body execution), including symtable lookup disambiguation for multiple lambdas on the same line.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_cpython_pynterp_probe.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check scripts/cpython_pynterp_probe.py tests/test_cpython_pynterp_probe.py`.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py tests/test_keyword_params.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/code.py src/pynterp/expressions.py src/pynterp/functions.py src/pynterp/helpers.py tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run python scripts/cpython_pynterp_probe.py --cpython-root /tmp/cpython-3.14 --python-exe /tmp/cpython-3.14/python.exe --basis tests --mode module --json-out .todo-loop/iter-002-probe-tests-module-post-lambda.json`.
- Metric delta: no baseline counts changed in this slice (instrumentation-only; probe metrics not rerun yet).
- Metric delta: top `Suite/Error` signature `NotImplementedError: Expression not supported: Lambda` dropped `345 -> 0`; `Suite/Error` category reduced `2,466 -> 2,207` (`-259`); individual pass `9,164 -> 9,872` (`+708`), individual fail `4,827 -> 4,334` (`-493`), and individual pass+skip rate `68.21% -> 71.90%` (`+3.69pp`).
- Progress (2026-02-27): implemented initial `ast.Match` runtime support (`MatchValue`, `MatchSingleton`, `MatchSequence`/`MatchStar`, `MatchMapping`, `MatchClass`, `MatchAs`, `MatchOr`) for both normal and generator statement execution paths.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k match`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/statements.py tests/test_core_semantics.py`.
- Metric delta: probe metrics not rerun in this slice; local regression checks added 3 new `match` semantics tests and `tests/test_core_semantics.py` remains `10 passed`.
- Progress (2026-02-27): implemented `AugAssign` target support for `Name`/`Attribute`/`Subscript` in both normal and generator execution paths, and switched augmented assignment ops to in-place operators to preserve aliasing behavior (`+=`, `*=`, etc.).
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k augassign`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/helpers.py src/pynterp/statements.py tests/test_core_semantics.py`.
- Metric delta: probe metrics not rerun in this slice; local regression coverage added 2 `augassign` semantics tests and `tests/test_core_semantics.py` now reports `12 passed`.
- Progress (2026-02-27, iter 005): implemented initial `AsyncFunctionDef` runtime support in normal and generator statement paths, added async-call trampoline execution, and implemented `Await` expression handling for interpreted async functions (async generators remain explicitly unsupported).
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k async`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_keyword_params.py tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/common.py src/pynterp/code.py src/pynterp/expressions.py src/pynterp/functions.py src/pynterp/helpers.py src/pynterp/statements.py src/pynterp/symtable_utils.py tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run python scripts/cpython_pynterp_probe.py --cpython-root /tmp/cpython-3.14 --python-exe /tmp/cpython-3.14/python.exe --basis tests --mode module --json-out .todo-loop/iter-005-probe-tests-module-post-async.json`.
- Metric delta: from `.todo-loop/iter-002-probe-tests-module-post-lambda.json` to `.todo-loop/iter-005-probe-tests-module-post-async.json`, `NotImplementedError: Statement not supported: AsyncFunctionDef` dropped `87 -> 0`; `Suite/Error` reduced `2,207 -> 1,732` (`-475`); individual pass `9,872 -> 11,123` (`+1,251`), individual fail `4,334 -> 3,395` (`-939`), and individual pass+skip rate `71.90% -> 78.55%` (`+6.65pp`). New async gap surfaced as `NotImplementedError: async generators are not supported` (`75`).
- Progress (2026-02-27, iter 006): implemented `Starred` support for collection literals (`list`/`tuple`/`set` unpacking) and assignment targets with starred unpacking semantics in both normal and generator execution paths.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k starred`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/helpers.py src/pynterp/expressions.py tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run python scripts/cpython_pynterp_probe.py --cpython-root /tmp/cpython-3.14 --python-exe /tmp/cpython-3.14/python.exe --basis tests --mode module --json-out .todo-loop/iter-006-probe-tests-module-post-starred.json`.
- Metric delta: from `.todo-loop/iter-005-probe-tests-module-post-async.json` to `.todo-loop/iter-006-probe-tests-module-post-starred.json`, `NotImplementedError: Expression not supported: Starred` dropped `112 -> 0` and `NotImplementedError: Assignment target not supported: Starred` dropped `97 -> 0`; `Suite/Error` reduced `1,732 -> 1,563` (`-169`); individual pass `11,123 -> 11,277` (`+154`), individual fail `3,395 -> 3,193` (`-202`), and individual pass+skip rate `78.55% -> 79.76%` (`+1.22pp`).
- Progress (2026-02-27, iter 007): implemented `ast.NamedExpr` (`:=`) evaluation in normal and generator expression paths, including CPython-compatible walrus scoping so assignment expressions inside comprehensions bind to the nearest non-comprehension scope.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k namedexpr`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/expressions.py tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run python scripts/cpython_pynterp_probe.py --cpython-root /tmp/cpython-3.14 --python-exe /tmp/cpython-3.14/python.exe --basis tests --mode module --json-out .todo-loop/iter-007-probe-tests-module-post-namedexpr.json`.
- Metric delta: from `.todo-loop/iter-006-probe-tests-module-post-starred.json` to `.todo-loop/iter-007-probe-tests-module-post-namedexpr.json`, `NotImplementedError: Expression not supported: NamedExpr` dropped `110 -> 0`; `Suite/Error` reduced `1,563 -> 1,454` (`-109`); individual pass `11,277 -> 11,412` (`+135`), individual fail `3,193 -> 3,071` (`-122`), and individual pass+skip rate `79.76% -> 80.55%` (`+0.79pp`).
- Progress (2026-02-27, iter 008): relaxed sandbox attr guard blocking for compatibility dunders (`__spec__`, `__loader__`, `__traceback__`, `__func__`), added `BoundMethod.__func__` compatibility, and added regression tests that verify these attributes are readable while `tb_frame` remains blocked.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k attr_guard`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/lib/guards.py src/pynterp/functions.py tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run python scripts/cpython_pynterp_probe.py --cpython-root /tmp/cpython-3.14 --python-exe /tmp/cpython-3.14/python.exe --basis tests --mode module --json-out .todo-loop/iter-008-probe-tests-module-post-guard-dunders.json`.
- Metric delta: from `.todo-loop/iter-007-probe-tests-module-post-namedexpr.json` to `.todo-loop/iter-008-probe-tests-module-post-guard-dunders.json`, blocked signatures for `__spec__` (`124`), `__loader__` (`116`), `__traceback__` (`40`), and `__func__` (`18`) dropped out of `top_suite_error_signatures`; `Suite/Error` reduced `1,454 -> 1,172` (`-282`); individual pass `11,412 -> 11,552` (`+140`), individual fail `3,071 -> 2,792` (`-279`), and individual pass+skip rate `80.55% -> 82.16%` (`+1.61pp`).
- Progress (2026-02-27, iter 009): implemented `ImportFrom` handling for `node.module is None` by routing those relative imports through `__import__` with an empty module name (CPython shape for `from . import ...` / `from .. import ...`), and added regression coverage for both one-level and two-level relative `from` imports.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k relative_without_module_name`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/statements.py tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run python scripts/cpython_pynterp_probe.py --cpython-root /tmp/cpython-3.14 --python-exe /tmp/cpython-3.14/python.exe --basis tests --mode module --json-out .todo-loop/iter-009-probe-tests-module-post-importfrom-none.json`.
- Metric delta: from `.todo-loop/iter-008-probe-tests-module-post-guard-dunders.json` to `.todo-loop/iter-009-probe-tests-module-post-importfrom-none.json`, `ImportError: from-import without module not supported` dropped `194 -> 0` and `Import/FromImportWithoutModule` dropped out of `top_fail_categories`; individual pass `11,552 -> 11,741` (`+189`), individual fail `2,792 -> 2,671` (`-121`), and individual pass+skip rate `82.16% -> 83.01%` (`+0.85pp`). New follow-on suite error surfaced as `PermissionError: [Errno 1] Operation not permitted` (`70`).
- Progress (2026-02-27, iter 010): fixed method-call keyword binding collisions by updating `BoundMethod.__call__` and `UserFunction.__call__` to avoid reserving the `self` keyword name in wrapper signatures; added regression coverage for calling an interpreted bound method with `self=` as a user keyword argument.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k bound_method_allows_keyword_named_self`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/functions.py tests/test_core_semantics.py`; `/tmp/cpython-3.14/python.exe` targeted module run for `Lib/test/test_operator.py`.
- Metric delta: from `.todo-loop/iter-009-probe-tests-module-post-importfrom-none.json`, suite-error signature `TypeError: BoundMethod.__call__() got multiple values for argument 'self'` was `26` (all in `Lib/test/test_operator.py`); targeted rerun of `Lib/test/test_operator.py` now reports `tests_run=110`, `failures=0`, `errors=0`, `skipped=0`, and signature count `0` (full probe metrics not rerun in this slice).
- Progress (2026-02-27, iter 011): fixed probe runner module-fixture semantics by temporarily registering interpreted test modules in `sys.modules` during `unittest` load/run (and restoring the previous entry afterward), so module-level fixtures like `setUpModule`/`tearDownModule` execute; added regression coverage in `test_run_case_executes_module_fixtures`.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_cpython_pynterp_probe.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check scripts/cpython_pynterp_probe.py tests/test_cpython_pynterp_probe.py`; targeted `run_case` reruns for `Lib/test/test_zoneinfo/test_zoneinfo.py` and `Lib/test/test_xml_etree.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: from `.todo-loop/iter-009-probe-tests-module-post-importfrom-none.json`, top suite-error signatures tied to missing module fixtures dropped in targeted reruns: `AttributeError: 'NoneType' object has no attribute 'tzpath'` `149 -> 0` and `AttributeError: 'NoneType' object has no attribute 'Element'` `98 -> 0`; `Lib/test/test_zoneinfo/test_zoneinfo.py` errors `157 -> 0`, and `Lib/test/test_xml_etree.py` errors `246 -> 5` (full probe metrics not rerun in this slice).
- Progress (2026-02-27, iter 012): implemented initial async-generator runtime support for interpreted `async def` functions containing `yield` (function classification plus `InterpretedAsyncGenerator` with `__aiter__`, `__anext__`, `asend`, `athrow`, and `aclose`), and added core semantics coverage for yielding, `asend`, `await` inside async generators, and `aclose`/`finally` behavior.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k async_generator`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py tests/test_keyword_params.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/helpers.py src/pynterp/functions.py src/pynterp/statements.py tests/test_core_semantics.py`; targeted `run_case` reruns for `Lib/test/test_asyncgen.py`, `Lib/test/test_asyncio/test_runners.py`, `Lib/test/test_asyncio/test_base_events.py`, and `Lib/test/test_unittest/test_async_case.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: targeted `run_case` baseline across those four async-generator files showed `NotImplementedError: async generators are not supported` at `75` total (`71 + 1 + 2 + 1`); post-change reruns show that signature `75 -> 0`. `Lib/test/test_asyncgen.py` shifted from `status=suite` (`tests_run=85`, `errors=72`) to `status=timeout` (both 30s and 120s reruns), indicating follow-on runtime timeout pressure rather than import-time async-generator failure.
- Progress (2026-02-27, iter 013): implemented `ast.TryStar` runtime support for both normal and generator statement execution paths, including `except*` exception-group splitting/handler binding/remainder propagation, and added `except*` compatibility builtins (`ExceptionGroup`, `BaseExceptionGroup`) plus core semantics regression coverage.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k trystar`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/statements.py src/pynterp/lib/builtins.py tests/test_core_semantics.py`; targeted `run_case` reruns for `Lib/test/test_except_star.py`, `Lib/test/test_exception_variations.py`, and `Lib/test/test_compile.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: prior full-probe top suite-error signature `NotImplementedError: Statement not supported: TryStar` was `47` (from `.todo-loop/iter-009-probe-tests-module-post-importfrom-none.json`); targeted post-change reruns show no `TryStar` unsupported signature in `error_signatures` for `Lib/test/test_except_star.py` (`status=suite`, `tests_run=60`, `errors=5`) and `Lib/test/test_exception_variations.py` (`status=suite`, `tests_run=30`, `errors=0`), indicating those files now execute past the missing-statement failure mode.
- Progress (2026-02-27, iter 014): implemented `ast.AsyncWith` runtime support in generator execution paths (awaited `__aenter__`/`__aexit__`, target binding, suppression handling, and exception propagation) and added core semantics regression tests for happy-path and suppression behavior.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k async_with`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/statements.py tests/test_core_semantics.py`; targeted `run_case` reruns for `Lib/test/test_asyncio/test_pep492.py`, `Lib/test/test_asyncio/test_free_threading.py`, `Lib/test/test_asyncio/test_streams.py`, `Lib/test/test_asyncio/test_eager_task_factory.py`, `Lib/test/test_asyncio/test_server.py`, `Lib/test/test_grammar.py`, and `Lib/test/test_with.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: prior full-probe top suite-error signature `NotImplementedError: Statement not supported: AsyncWith` was `18` (from `.todo-loop/iter-009-probe-tests-module-post-importfrom-none.json`); targeted reruns across the same seven previously-listed files show that signature at `0` total (`TOTAL_ASYNCWITH_SIGNATURE 0`), while residual errors in some files now reflect follow-on issues rather than missing `AsyncWith`.
- Progress (2026-02-27, iter 015): probe runner now removes a stale working-directory `tempcwd` directory before each module run, preventing cross-module `temp_cwd` collisions that surfaced as suite errors.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_cpython_pynterp_probe.py -k stale_tempcwd`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_cpython_pynterp_probe.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check scripts/cpython_pynterp_probe.py tests/test_cpython_pynterp_probe.py`; targeted `run_case` reruns for `Lib/test/test_tarfile.py`, `Lib/test/test_fstring.py`, and `Lib/test/test_peg_generator/test_c_parser.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: targeted reruns show suite-error signature `FileExistsError: [Errno 17] File exists: 'tempcwd'` dropped `12 -> 0` across those three files (`7 -> 0`, `4 -> 0`, `1 -> 0` respectively). File error totals shifted as `test_tarfile.py` `7 -> 0`, `test_fstring.py` `8 -> 4`, and `test_peg_generator/test_c_parser.py` `1 -> 0` (full probe metrics not rerun in this slice).
- Progress (2026-02-27, iter 016): implemented `ast.TemplateStr`/`ast.Interpolation` runtime support in expression evaluation (normal and generator paths), constructing `string.templatelib.Template`/`Interpolation` objects with CPython-compatible conversion and format-spec metadata; added core semantics coverage for direct and generator-path template-string evaluation.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k templatestr`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/expressions.py tests/test_core_semantics.py`; targeted `run_case` reruns for `Lib/test/test_tstring.py` and `Lib/test/test_string/test_templatelib.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: prior full-probe top suite-error signature `NotImplementedError: Expression not supported: TemplateStr` was `18` (from `.todo-loop/iter-009-probe-tests-module-post-importfrom-none.json`); targeted post-change reruns show that signature at `0` total across those two files (`TOTAL_TEMPLATESTR_SIGNATURE 0`). `Lib/test/test_tstring.py` now runs clean (`tests_run=12`, `errors=0`), while `Lib/test/test_string/test_templatelib.py` advances past the missing-expression failure and now reports follow-on `TypeError: Template.__new__ only accepts *args arguments` (`2`).
- Progress (2026-02-27, iter 017): normalized typing runtime-factory `__module__` attribution (`TypeVar`, `ParamSpec`, `TypeVarTuple`, `NewType`) to the interpreted module namespace in both normal and generator call paths; added core semantics regression tests for typing module attribution and `GenericAlias` pickling with `TypeVar`.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k "typing_runtime_factories or genericalias_pickle"`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/expressions.py tests/test_core_semantics.py`; targeted `run_case` reruns for `Lib/test/test_genericalias.py`, `Lib/test/test_positional_only_arg.py`, and `Lib/test/test_type_params.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: targeted rerun of `Lib/test/test_genericalias.py` improved from `tests_run=36, errors=45` to `tests_run=36, errors=3`; suite-error signatures `when serializing types.GenericAlias object` dropped `30 -> 0` and `when serializing typing._UnpackGenericAlias object` dropped `12 -> 0`. Residual `test_genericalias.py` errors are now `NotImplementedError: Statement not supported: TypeAlias` (`2`) and `TypeError: GenericAlias expected 2 arguments, got 3` (`1`).
- Progress (2026-02-27, iter 018): implemented initial `ast.TypeAlias` runtime support in normal and generator statement paths, including `TypeVar`/`ParamSpec`/`TypeVarTuple` type-parameter construction, non-leaking type-parameter overlay scope during alias evaluation, and core semantics coverage for alias module attribution, generic alias specialization, and non-leaking type parameters.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k typealias`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py tests/test_keyword_params.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/statements.py tests/test_core_semantics.py`; targeted `run_case` reruns for `Lib/test/test_genericalias.py`, `Lib/test/test_positional_only_arg.py`, and `Lib/test/test_type_params.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: from the iter-017 targeted baseline, `Lib/test/test_genericalias.py` suite errors reduced `3 -> 1` (`-2`), and suite-error signature `NotImplementedError: Statement not supported: TypeAlias` dropped `2 -> 0`; residual `test_genericalias.py` suite error is `TypeError: GenericAlias expected 2 arguments, got 3` (`1`).
- Progress (2026-02-27, iter 019): aligned class-definition runtime semantics with CPython for generic alias bases and local qualnames by resolving class bases via `types.resolve_bases` (`__mro_entries__`), propagating runtime `__qualname__` through function/class/lambda definitions, and relaxing attr guard blocking for class `__bases__` while keeping `__subclasses__` blocked.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k "generic_alias_base_resolves_to_origin_type or local_class_qualname_in_method_scope or attr_guard_allows_class_bases_but_blocks_subclasses"`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py tests/test_keyword_params.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/scopes.py src/pynterp/functions.py src/pynterp/helpers.py src/pynterp/statements.py src/pynterp/expressions.py src/pynterp/lib/guards.py tests/test_core_semantics.py`; targeted `run_case` rerun for `Lib/test/test_genericalias.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: targeted `run_case` for `Lib/test/test_genericalias.py` improved from `tests_run=36, failures=0, errors=1` to `tests_run=36, failures=0, errors=0`; suite-error signature `TypeError: GenericAlias expected 2 arguments, got 3` dropped `1 -> 0`, and the follow-on blocked-attr signature `AttributeError: attribute access to '__bases__' is blocked in this environment` dropped `1 -> 0`.
- Progress (2026-02-27, iter 020): probe runner now patches `concurrent.futures.process._check_system_limits` to convert sandbox-triggered `PermissionError` into `NotImplementedError`, so modules like `test_compileall` degrade to "no multiprocessing" behavior instead of import-time suite errors.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_cpython_pynterp_probe.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check scripts/cpython_pynterp_probe.py tests/test_cpython_pynterp_probe.py`; targeted `run_case` rerun for `Lib/test/test_compileall.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: prior full-probe category `PermissionError` was `70` (all in `Lib/test/test_compileall.py`, from `.todo-loop/iter-009-probe-tests-module-post-importfrom-none.json`); targeted post-change rerun for `Lib/test/test_compileall.py` now reports `status=suite`, `tests_run=139`, `failures=0`, `errors=0`, `skipped=16`, and no `PermissionError` import failure.
- Progress (2026-02-27, iter 021): fixed dotted `import ... as ...` binding semantics so aliased imports resolve to the leaf module (`import unittest.mock as mock` binds `mock` to `unittest.mock`, not `unittest`); added regression coverage for dotted imports with and without aliases.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k "import_dotted_module"`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/statements.py tests/test_core_semantics.py`; targeted `run_case` rerun for `Lib/test/test_xml_etree.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: targeted `run_case` for `Lib/test/test_xml_etree.py` improved from `tests_run=218, failures=0, errors=5, skipped=5` to `tests_run=218, failures=0, errors=0, skipped=5`; suite-error signatures `AttributeError: module 'unittest' has no attribute 'patch'` dropped `4 -> 0` and `AttributeError: module 'xml' has no attribute 'codes'` dropped `1 -> 0`.
- Progress (2026-02-27, iter 022): fixed call dispatch to omit `**kwargs` when the keyword map is empty in both normal and generator expression paths, matching CPython behavior for C callables that reject keyword call shapes even with an empty mapping (for example `string.templatelib.Template`); added a regression test for interpreted `Template(Interpolation(...))` construction.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k "template_constructor_positional_call_without_empty_kwargs or templatestr"`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/expressions.py tests/test_core_semantics.py`; targeted `run_case` rerun for `Lib/test/test_string/test_templatelib.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: targeted `run_case` for `Lib/test/test_string/test_templatelib.py` improved from `tests_run=13, failures=0, errors=2, skipped=0` to `tests_run=13, failures=0, errors=0, skipped=0`; suite-error signature `TypeError: Template.__new__ only accepts *args arguments` dropped `2 -> 0`.
- Progress (2026-02-27, iter 023): implemented `ast.AsyncFor` runtime support for async execution paths (`g_exec_AsyncFor`), including async iterator validation (`__aiter__`/`__anext__`), CPython-shaped invalid-`__anext__` error wrapping, and loop control semantics (`break`, `continue`, `else`); added regression coverage for async-for control flow and error-shape behavior.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k async_for`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/statements.py tests/test_core_semantics.py`; targeted `run_case` rerun for `Lib/test/test_coroutines.py` via `/tmp/cpython-3.14/python.exe`.
- Metric delta: targeted `run_case` for `Lib/test/test_coroutines.py` improved from `tests_run=99, failures=13, errors=31` to `tests_run=99, failures=14, errors=21`; suite-error signature `NotImplementedError: Statement not supported: AsyncFor` dropped `12 -> 0`. Follow-on async gap now leads with `NotImplementedError: async comprehensions not supported` (`8 -> 10`) as tests progress further.
- Progress (2026-02-27, iter 024): implemented async-comprehension runtime support in generator execution paths for `ListComp`/`SetComp`/`DictComp` plus async `GeneratorExp`, reusing async-for iterator validation/error-shaping and adding regression coverage for async comprehensions (including async generator expressions and generator-path async-function definitions).
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k "async_list_set_dict_comprehensions or async_generator_expression_produces_async_iterator or async_comprehension_works_in_generator_execution_path"`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/expressions.py tests/test_core_semantics.py`; targeted `run_case` rerun for `Lib/test/test_coroutines.py` via `scripts/cpython_pynterp_probe.run_case`.
- Metric delta: targeted `run_case` for `Lib/test/test_coroutines.py` improved from `tests_run=99, failures=14, errors=21` to `tests_run=99, failures=13, errors=14`; suite-error signature `NotImplementedError: async comprehensions not supported` dropped `10 -> 0`.
- Progress (2026-02-27, iter 025): tightened `AsyncWith` protocol/runtime checks in generator execution paths to match CPython behavior for missing async context-manager methods and invalid non-awaitable returns from `__aenter__`/`__aexit__`; added regression coverage for missing-method and invalid-awaitable cases.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k async_with`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/statements.py tests/test_core_semantics.py`; targeted `run_case` rerun for `Lib/test/test_coroutines.py` via `scripts/cpython_pynterp_probe.run_case`.
- Metric delta: targeted `run_case` for `Lib/test/test_coroutines.py` improved from `tests_run=99, failures=13, errors=14` to `tests_run=99, failures=10, errors=11`; suite-error signatures `AttributeError: 'CM' object has no attribute '__aenter__'. Did you mean: '__delattr__'?` (`2`) and `AttributeError: 'CM' object has no attribute '__aexit__'. Did you mean: '__init__'?` (`1`) dropped to `0`.
- Progress (2026-02-27, iter 026): implemented bare `raise` (re-raise) semantics in normal and generator statement execution paths by tracking active handled exceptions per runtime scope across `try`/`except` and `try`/`except*`; added regression coverage for successful re-raise, generator-path re-raise, and no-active-exception behavior.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k bare_raise`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/scopes.py src/pynterp/statements.py tests/test_core_semantics.py`; targeted `run_case` rerun for `Lib/test/test_coroutines.py` via `scripts/cpython_pynterp_probe.run_case`.
- Metric delta: targeted `run_case` for `Lib/test/test_coroutines.py` improved from `tests_run=99, failures=10, errors=11` to `tests_run=99, failures=10, errors=10`; suite-error signature `RuntimeError: re-raise not supported in this interpreter` dropped `1 -> 0`.
- Progress (2026-02-27, iter 027): fixed interpreted async-generator error handling to wrap leaked `StopAsyncIteration` as `RuntimeError("async generator raised StopAsyncIteration")` with the original exception as `__cause__`, and added regression coverage using an async generator expression with assignment-target side effects.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k "async_generator_wraps_stopasynciteration_as_runtimeerror or async_generator_produces_values or async_generator_asend_passes_values_to_yield_expression or nonlocal_closure or await_expression_uses_custom_awaitable or lambda_closure_and_defaults"`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/helpers.py tests/test_core_semantics.py`; targeted `run_case` rerun for `Lib/test/test_coroutines.py` via `scripts/cpython_pynterp_probe.run_case`.
- Metric delta: targeted `run_case` for `Lib/test/test_coroutines.py` improved from `tests_run=99, failures=10, errors=10` to `tests_run=99, failures=10, errors=8`; suite-error signature `StopAsyncIteration: 42` dropped `2 -> 0`.
- Progress (2026-02-27, iter 028): refined generator-expression async classification so outer generator expressions become async iterators only when evaluating the expression requires awaiting (for example nested async list comprehensions), while nested async generator expressions remain normal sync iterables; added regression coverage for both cases.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k "nested_async_comprehension_is_async or yielding_async_generators_stays_sync_iterable or async_generator_expression_produces_async_iterator"`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/expressions.py tests/test_core_semantics.py`; targeted `run_case` rerun for `Lib/test/test_coroutines.py` via `scripts/cpython_pynterp_probe.run_case`.
- Metric delta: targeted `run_case` for `Lib/test/test_coroutines.py` improved from `tests_run=99, failures=10, errors=8` to `tests_run=99, failures=10, errors=7`; suite-error signature `TypeError: 'async for' requires an object with __aiter__ method, got generator` dropped `1 -> 0`. Remaining `test_coroutines.py` suite errors are all sandbox-blocked attribute access signatures (`cr_frame`, `f_back`, `__code__`, `__dict__`).
- Progress (2026-02-27, iter 029): relaxed sandbox attr guards to allow coroutine/frame introspection for `cr_frame` and `f_back`, while keeping `f_globals`/`f_builtins` blocked; added regression coverage for normal and generator execution paths.
- Checks: `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py -k "attr_guard_allows_coroutine_frame"`; `UV_CACHE_DIR=.uv-cache uv run pytest tests/test_core_semantics.py`; `UV_CACHE_DIR=.uv-cache uv run ruff check src/pynterp/lib/guards.py tests/test_core_semantics.py`; targeted `run_case` rerun for `Lib/test/test_coroutines.py` via `scripts/cpython_pynterp_probe.run_case`.
- Metric delta: targeted `run_case` for `Lib/test/test_coroutines.py` improved from `tests_run=99, failures=10, errors=7` to `tests_run=99, failures=11, errors=2`; blocked suite-error signatures for `cr_frame` and `f_back` dropped to `0` each. Remaining suite errors are blocked `__code__` (`1`) and `__dict__` (`1`) signatures.
- Blocker (2026-02-27): `git add`/`git commit` still fail in this environment with `fatal: Unable to create '/Users/grantjenks/repos/python-pynterp/.git/index.lock': Operation not permitted`.
- Blocker (2026-02-27, iter 027): commit attempt for this slice (`git add TODO.md src/pynterp/helpers.py tests/test_core_semantics.py && git commit -m "todo: wrap asyncgen StopAsyncIteration"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 028): commit attempt for this slice (`git add TODO.md src/pynterp/expressions.py tests/test_core_semantics.py && git commit -m "todo: refine async generator expression classification"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 029): commit attempt for this slice (`git add TODO.md src/pynterp/lib/guards.py tests/test_core_semantics.py && git commit -m "todo: allow coroutine frame attr guards"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 019): commit attempt for this slice (`git add TODO.md src/pynterp/scopes.py src/pynterp/functions.py src/pynterp/helpers.py src/pynterp/statements.py src/pynterp/expressions.py src/pynterp/lib/guards.py tests/test_core_semantics.py && git commit -m "todo: fix genericalias class base semantics"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 020): commit attempt for this slice (`git add TODO.md scripts/cpython_pynterp_probe.py tests/test_cpython_pynterp_probe.py && git commit -m "todo: normalize sysconf permission probe failures"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 021): commit attempt for this slice (`git add TODO.md src/pynterp/statements.py tests/test_core_semantics.py && git commit -m "todo: fix dotted import alias binding"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 022): commit attempt for this slice (`git add TODO.md src/pynterp/expressions.py tests/test_core_semantics.py && git commit -m "todo: fix empty kwargs call dispatch"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 023): commit attempt for this slice (`git add TODO.md src/pynterp/statements.py tests/test_core_semantics.py && git commit -m "todo: add async for statement support"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 024): commit attempt for this slice (`git add TODO.md src/pynterp/expressions.py tests/test_core_semantics.py && git commit -m "todo: add async comprehension runtime support"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 025): commit attempt for this slice (`git add TODO.md src/pynterp/statements.py tests/test_core_semantics.py && git commit -m "todo: tighten async with protocol checks"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 026): commit attempt for this slice (`git add TODO.md src/pynterp/scopes.py src/pynterp/statements.py tests/test_core_semantics.py && git commit -m "todo: support bare reraise semantics"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 003): commit attempt for this slice (`git add TODO.md src/pynterp/statements.py tests/test_core_semantics.py && git commit -m "todo: add initial match statement runtime support"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 004): commit attempt for this slice (`git add TODO.md src/pynterp/helpers.py src/pynterp/statements.py tests/test_core_semantics.py && git commit -m "todo: support augassign attribute and subscript targets"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 005): commit attempt for this slice (`git add TODO.md src/pynterp/code.py src/pynterp/common.py src/pynterp/expressions.py src/pynterp/functions.py src/pynterp/helpers.py src/pynterp/statements.py src/pynterp/symtable_utils.py tests/test_core_semantics.py && git commit -m "todo: add initial async function and await support"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 006): commit attempt for this slice (`git add TODO.md src/pynterp/helpers.py src/pynterp/expressions.py tests/test_core_semantics.py && git commit -m "todo: support starred expressions and unpack targets"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 007): commit attempt for this slice (`git add TODO.md src/pynterp/expressions.py tests/test_core_semantics.py && git commit -m "todo: add namedexpr expression support"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 008): commit attempt for this slice (`git add TODO.md src/pynterp/lib/guards.py src/pynterp/functions.py tests/test_core_semantics.py && git commit -m "todo: relax guard blocking for compatibility dunders"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 009): commit attempt for this slice (`git add TODO.md src/pynterp/statements.py tests/test_core_semantics.py && git commit -m "todo: support relative from-import without module"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 010): commit attempt for this slice (`git add TODO.md src/pynterp/functions.py tests/test_core_semantics.py && git commit -m "todo: fix bound method self keyword collisions"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 011): commit attempt for this slice (`git add TODO.md scripts/cpython_pynterp_probe.py tests/test_cpython_pynterp_probe.py && git commit -m "todo: fix probe module fixture setup"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 012): commit attempt for this slice (`git add TODO.md src/pynterp/functions.py src/pynterp/helpers.py src/pynterp/statements.py tests/test_core_semantics.py && git commit -m "todo: add initial async generator runtime support"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 013): commit attempt for this slice (`git add TODO.md src/pynterp/statements.py src/pynterp/lib/builtins.py tests/test_core_semantics.py && git commit -m "todo: add trystar statement runtime support"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 014): commit attempt for this slice (`git add TODO.md src/pynterp/statements.py tests/test_core_semantics.py && git commit -m "todo: add async with statement runtime support"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 015): commit attempt for this slice (`git add TODO.md scripts/cpython_pynterp_probe.py tests/test_cpython_pynterp_probe.py && git commit -m "todo: clean stale tempcwd before probe runs"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 016): commit attempt for this slice (`git add TODO.md src/pynterp/expressions.py tests/test_core_semantics.py && git commit -m "todo: add templatestr expression support"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 017): commit attempt for this slice (`git add TODO.md src/pynterp/expressions.py tests/test_core_semantics.py && git commit -m "todo: fix typing runtime module attribution"`) failed with the same `.git/index.lock` permission error.
- Blocker (2026-02-27, iter 018): commit attempt for this slice (`git add TODO.md src/pynterp/statements.py tests/test_core_semantics.py && git commit -m "todo: add typealias statement runtime support"`) failed with the same `.git/index.lock` permission error.

2. Implement `AsyncFunctionDef` support (`753` tests impacted).
- Reason: largest single missing AST statement form.
- Requirement: support async function definition/runtime behavior required by `asyncio` test modules.
- Progress (2026-02-27, iter 005): async function definition/call support is now in place (including `await` execution); remaining work is broader async coverage (`AsyncWith`, async comprehensions, and async generator semantics).
- Progress (2026-02-27, iter 012): initial async generator semantics are now supported (`__anext__`, `asend`, `athrow`, `aclose`); remaining async gaps are `AsyncWith`, async comprehensions, and timeout-heavy asyncio modules.
- Progress (2026-02-27, iter 014): `AsyncWith` support is now in place for interpreted async execution; remaining async gaps are async comprehensions and timeout-heavy asyncio modules.

3. SKIP ~~Define policy for optional GUI dependencies (`_tkinter`) (`470` tests impacted).~~
- Reason: currently counted as failures but likely out of project scope.
- Requirement: either install/enable `_tkinter` in the probe runtime or explicitly exclude `test_tkinter` via unsupported filters.

4. Implement `Lambda` expression support (`227` tests impacted).
- Reason: high-impact missing expression feature.
- Requirement: support `ast.Lambda` with closure/default binding semantics compatible with existing function call behavior.

5. Fix `from ... import ...` with implicit/relative module contexts (`194` tests impacted).
- Reason: import semantics gap appears directly in `importlib` test families.
- Requirement: support `ImportFrom` where `node.module is None` and ensure relative resolution matches CPython behavior.
- Progress (2026-02-27, iter 009): `ImportFrom` now supports `node.module is None` (relative `from .` / `from ..` imports), and the probe reason `ImportError: from-import without module not supported` dropped `194 -> 0`.

6. Reduce runtime timeouts (`177` tests impacted).
- Reason: timeouts hide pass/fail status and slow iteration.
- Requirement: profile top timeout files (`test_asyncio/test_events.py`, `test_queue.py`, `test_sched.py`, `test_thread.py`, `test_zipfile64.py`) and either optimize or isolate pathological paths.

7. Reduce `Suite/Failure` assertion failures (`194` tests impacted).
- Reason: logic-level mismatches after tests execute.
- Requirement: prioritize top files (`test_augassign.py`, `test_codeop.py`, `test_asyncio/test_futures.py`, `test_ctypes/test_struct_fields.py`, `test_dbm_dumb.py`) and align semantics.

8. Triage residual `AttributeError` compatibility gaps (`81` tests impacted).
- Reason: non-sandbox attribute errors indicate missing stdlib/runtime compatibility.
- Requirement: classify and fix recurring attribute contract mismatches (`test`/`unittest` helper expectations, enum/member metadata expectations).

9. Implement `Starred` expression support (`36` tests impacted).
- Requirement: support `ast.Starred` in remaining expression contexts not currently handled.

10. Implement `TypeAlias` statement support (`30` tests impacted).
- Requirement: support `ast.TypeAlias` for 3.14 typing-related tests.

11. SKIP ~~Decide final policy for `__code__` access (`29` tests impacted).~~
- Reason: currently blocked by sandbox guard.
- Requirement: either keep blocked and exclude related tests, or add a constrained capability path if needed for target compatibility.

## Scope note

- Keep unsupported-feature filters explicit and versioned in the probe.
- Do not silently mix environment-missing modules with interpreter semantic failures in progress metrics.
